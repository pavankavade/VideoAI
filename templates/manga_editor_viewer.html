<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{ project.title }} – Panels</title>
  <style>
    body{margin:0;font-family:system-ui,Inter,Segoe UI,Arial,sans-serif;background:#0b1324;color:#e6f0ff}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .btn{background:#3b82f6;color:#fff;border:none;border-radius:8px;padding:8px 12px;font-weight:600;cursor:pointer}
    .page{background:#0e1a31;border:1px solid #1c2a4a;border-radius:12px;padding:12px;margin:10px 0}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:10px}
    .panel{border:1px solid #1c2a4a;border-radius:8px;overflow:hidden;background:#061022}
    .panel img{display:block;width:100%;height:160px;object-fit:cover}
    .meta{font-size:12px;color:#9fbfdc;padding:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <h2>{{ project.title }} – Panels</h2>
      <a class="btn" href="/editor/manga-editor/{{ project.id }}">Back to Editor</a>
    </div>
    <div id="root"></div>
  </div>
  <script>
    const project = JSON.parse(document.getElementById('project-data')?.textContent || '{}');
    async function load(){
      const r = await fetch(`/editor/api/project/${project.id}`);
      const d = await r.json();
      const root = document.getElementById('root');
      root.innerHTML = '';
      (d.pages||[]).forEach(pg => {
        const div = document.createElement('div');
        div.className = 'page';
        div.innerHTML = `<h3>Page ${pg.page_number}</h3><div class="grid">${(pg.panels||[]).map(p=>`<div class="panel"><img src="${p.image}"/><div class="meta">#${p.index}</div></div>`).join('')}</div>`;
        root.appendChild(div);
      });
    }
    load();
  </script>
  <script id="project-data" type="application/json">{{ project|tojson|safe }}</script>
</body>
</html>
